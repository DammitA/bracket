<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Doner Competition Software</title>
  <style>
    :root {
      --panel-bg: rgba(255, 255, 255, 0.9);
      --panel-border: #e0e0e0;
      --text: #222;
      --muted: #666;
      --btn: #f5f5f5;
      --btn-border: #d0d0d0;
      --btn-text: #222;
      --btn-disabled: #e9e9e9;
      --btn-disabled-text: #9a9a9a;
    }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 20px auto;
      color: var(--text);
	  max-width: 960px;
      position: relative;
      min-height: 100vh;
    }
    /* Full-page background image */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: url("background.jpg") center/cover no-repeat fixed;
      z-index: -2;
    }
    /* Light overlay for readability */
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(255, 255, 255, 0.85);
      z-index: -1;
    }
    .title-section {
      width: 100%;
      max-width: 1500px;
      padding: 12px 16px;
      margin: 4px 0 12px;
      color: var(--text);
      text-align: center;
      background: var(--panel-bg);
      border: 1px solid var(--panel-border);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
    }
    #controls input {
      margin: 0 5px;
    }
    button {
      margin: 5px;
      padding: 6px 12px;
      border: 1px solid var(--btn-border);
      border-radius: 6px;
      background: var(--btn);
      color: var(--btn-text);
      cursor: pointer;
    }
    button:disabled {
      background: var(--btn-disabled);
      color: var(--btn-disabled-text);
      border-color: #ddd;
      cursor: not-allowed;
      opacity: 1;
    }
    /* Update the table styles */
    table {
      border-collapse: collapse;
      width: 600px;          /* Set a fixed width */
      margin: 10px;     /* Center the table horizontally with auto margins */
    }
    .table-wrap { display: inline-block; max-height: 600px; overflow: auto; background: #fff; border: 1px solid var(--panel-border); border-radius: 6px; }
    table, th, td {
      border: 1px solid #ccc;
      padding: 5px;
      text-align: left;
    }
    #competitorsTable thead th { position: sticky; top: 0; background: #fff; z-index: 1; }
	.content-container {
		display: flex;
		flex-direction: column;
		gap: 16px;
		margin-bottom: 20px;
		align-items: stretch;
    }
	.roster-container {
	}
	.extra-info{
	  flex-grow: 0;
	  height: auto; 
	  min-width: 300px;
	  background: var(--panel-bg);
	  padding: 10px;
	  border: 1px solid var(--panel-border);
	  border-radius: 8px;
	  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
	  margin: 30px 1px 1px;
	}
	.extra-info h2{
		margin-top: 0px;	
	}
	.info-container{
	  flex-grow: 0;
	  height: auto; 
	  min-width: 250px;
	  background: var(--panel-bg);
	  padding: 10px;
	  border: 1px solid var(--panel-border);
	  border-radius: 8px;
	  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
	  margin: 68px 1px 1px;
	}
	.info-container h2 {
	  margin-top: 0;
	}
    .pairing {
      display: flex;
      flex-direction: row;
      align-items: center;
      margin-bottom: 12px;
      padding: 8px 10px;
      background: #fff;
      border: 1px solid var(--panel-border);
      border-radius: 6px;
    }
    .pairing-text { flex: 1; min-width: 520px; margin-right: 16px; }
    .pairing-select { margin-left: auto; margin-right: 5px; width: 220px }
    .unlock-button {
      margin-left: 5px;
    }
    .link-button {
      background: transparent;
      border: none;
      color: var(--muted);
      text-decoration: underline;
      padding: 0 4px;
      cursor: pointer;
    }
    .team-badge {
      display: inline-block;
      padding: 2px 6px;
      margin: 0 6px 0 0;
      border-radius: 999px;
      border: 1px solid var(--panel-border);
      background: #fafafa;
      font-size: 12px;
      color: var(--muted);
    }
    .record { color: var(--muted); font-size: 13px; margin-left: 6px; }
    #competitorsTable tbody tr:nth-child(even) {
      background-color: #f7f7f7;
    }
    #diagnostics {
      font-size: 0.9em;
      margin-bottom: 10px;
      color: var(--muted);
    }

    /* Status bar */
    #statusBar { margin: 8px 0 14px; color: var(--muted); }
    #statusBar strong { color: var(--text); }

    /* Responsive layout */
    @media (max-width: 900px) {
      .content-container { flex-direction: column; }
      .pairing-text { width: auto; }
      table { width: 100%; }
    }
  </style>
</head>

<body>
  <!-- The rest of your HTML remains unchanged -->
  <!-- h1>Donner Competition Software: Double Elimination!</h1 -->
  <div class="title-section">  
    <h1>Doner Competition Software</h1>
    <div id="statusBar" aria-live="polite"></div>
  </div>
  
  <div id="controls">
    <div class="controls-row">
      <input type="text" id="name" placeholder="Name">
      <input type="text" id="team" placeholder="Team">
      <button id="addCompetitor">Add Competitor</button>
      <button id="removeCompetitor">Remove Competitor</button>
    </div>
    <div class="controls-row">
      <button id="saveRoster">Save Match</button>
      <button id="loadRoster">Load Match</button>
      <input type="file" id="loadRosterInput" style="display:none" accept=".csv">
      <button id="calcTeamPoints">Calc Team Points</button>
      <label for="eliminationThreshold">Losses to elimination:</label>
      <input type="number" id="eliminationThreshold" value=2 min=1>
    </div>
    <div class="controls-row">
      <button id="sampleTeams">Sample Teams</button>
      <button id="resetScores">Reset Scores</button>
      <button id="eraseCompetitors" disabled>Reset All Data</button>
      <button id='adminMode'>Admin Mode</button>
      <button id='tiebreakThirdFourth' title='Enable a 2nd–3rd tiebreaker match if needed' disabled>2nd–3rd Tiebreaker</button>
    </div>
  </div>
 
  <div class='content-container'> 
    <div id="roster-container"> 
      <div id="teamPointsDisplay"></div>
      <h2>Record</h2>
      <div id="rosterFilters" style="margin:6px 10px;">
        <label><input type="checkbox" id="filterActiveOnly"> Hide Eliminated</label>
        <label style="margin-left:10px;">Team: <select id="filterTeam"><option value="">All</option></select></label>
      </div>
      <div class="table-wrap">
      <table id="competitorsTable">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Team</th>
            <th>Wins</th>
            <th>Losses</th>
          </tr>
        </thead>
        <tbody>
          <!-- Competitor rows will be inserted here -->
        </tbody>
      </table>
      </div>
    </div>

    <div id="matchups-container">
      <div>
        <button id="beginCompetition">Begin Competition</button>
      </div>
      <h2>Match Ups</h2>
      <div id="results"><!-- Pairings --></div>
      <button id="finalizeRound">Finalize: Generate Next Round</button>
    </div>

    <div class="info-container" style="margin-top:16px;">
      <h2> How to: <button id="toggleHowTo" class="link-button" aria-expanded="true" aria-controls="infoText">Hide</button></h2>
      <div id="infoText">
        <ol>
          <li> Add competitors by entering their name and (optional) team, then press 'Add Competitor'.</li>
          <li> Set 'Losses to elimination' as desired, then press 'Begin Competition' to generate pairings.</li>
          <li> Select a winner for every non-BYE match. BYEs require no selection. 'Finalize' enables only when all required winners are selected; click it to record results and generate the next round.</li>
          <li> The tournament ends when one competitor remains below the loss threshold.</li>
        </ol>
      </div>
    </div>

    <div class='extra-info'>
	  <h2>Extra information <button id="toggleExtraInfo" class="link-button" aria-expanded="true" aria-controls="extraInfoBody">Hide</button></h2>
	  <div id="extraInfoBody">
	  <ol>
            <li> Records and current pairings persist locally in your browser. You can export/import the 'Record' as CSV at any time.</li>
            <li> Saved pairings are validated against the current roster and loss threshold; if they don't match, new pairings are computed automatically.</li>
            <li> BYEs do not count as wins or losses. When a loss group is odd-sized, the highest-wins competitor receives the BYE, reducing repeated BYEs as others accrue wins.</li>
            <li> Team avoidance is prioritized. The matcher minimizes same-team pairings with randomized attempts and a light improvement pass, but teammates may still be paired when unavoidable.</li>
	  </ol>
	  <h3>Interface Quick Reference</h3>
	  <ul>
	    <li><strong>Add/Remove Competitor</strong> - Manage the roster one athlete at a time; teams are optional and drive the team-points view.</li>
	    <li><strong>Save/Load Match</strong> - Export the roster and records to CSV or restore them from a previous event or device.</li>
	    <li><strong>Reset Scores</strong> - Zero out wins and losses without touching the roster for a fresh run-through.</li>
	    <li><strong>Reset All Data</strong> - Clear competitors, pairings, round history, and stored browser data for a clean slate.</li>
	    <li><strong>Begin Competition / Finalize</strong> - Generate round pairings and lock in results once every winner is selected.</li>
	    <li><strong>Admin Mode</strong> - Temporarily unlock the table so names, teams, wins, and losses can be edited directly.</li>
	    <li><strong>Calc Team Points</strong> - Summarize cumulative wins minus losses by team for quick squad standings.</li>
	    <li><strong>2nd-3rd Tiebreaker</strong> - When enabled, produces a one-off playoff match to resolve podium ties.</li>
	  </ul>
	  <h3> Match Up Logic</h3>
	  <p>This software replaces classic fixed brackets with dynamic pairings by record. Undefeated competitors play undefeated; one-loss play one-loss, and so on. Within each loss group, competitors with fewer wins tend to be paired first so BYEs go to those who have fought the most. Team avoidance is prioritized but not guaranteed when constraints force it.</p>
	  <p><strong>Single elimination</strong> (loss threshold = 1) naturally produces a finals pairing once only two undefeated entrants remain; any odd round assigns the BYE to the most battle-tested undefeated player to keep the bracket balanced. <strong>Double elimination</strong> (threshold = 2) keeps athletes alive until their second loss, tracks undefeated and one-loss brackets separately, and automatically promotes a lone undefeated into the one-loss pool if higher thresholds create a mismatch. When the field shrinks to two, the system schedules the decisive rematch; if a custom tiebreaker is toggled, a one-off playoff is generated without disturbing prior rounds.</p>
      <h2> Diagnostics </h2>
      <div id="diagnostics"> </div>
      </div>
  </div>
  </div>

  <script src="logic.js"></script>
  <script src="main.js"></script>
</body>
</html>
